<% layout("/mentor/layouts/boilerplate") -%>
<div class="container mt-4">
    <h1>Pending Connection Requests</h1>
    <% if (requests.length === 0) { %>
    <p>No pending requests at the moment.</p>
    <% } else { %>
    <div class="list-group">
        <% requests.forEach(request => { %>
        <div class="list-group-item">
            <h5><%= request.mentee.user.username %></h5>
            <p><%= request.mentee.bio || "No bio provided." %></p>
            <button class="btn btn-success accept-btn" data-id="<%= request._id %>">Accept</button>
            <button class="btn btn-danger reject-btn" data-id="<%= request._id %>">Reject</button>
        </div>
        <% }) %>
    </div>
    <% } %>
</div>
<script>
    document.querySelectorAll(".accept-btn, .reject-btn").forEach(button => {
        button.addEventListener("click", function () {
            const requestId = this.dataset.id;
            const action = this.classList.contains("accept-btn") ? "accept" : "reject";
            fetch("/connections/respond-request", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ requestId, action }),
            })
                .then(res => res.json())
                .then(data => {
                    alert(data.message);
                    location.reload();
                })
                .catch(err => console.error(err));
        });
    });
</script>
